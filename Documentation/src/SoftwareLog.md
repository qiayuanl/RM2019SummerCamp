## 7组软件工程日志

### 序

我是海森, 软件部分的项目管理者. 在接下去的篇幅里, 我将带你纵览七组软件开发的一系列里程碑事件.



### Sprint 1

#### Git建仓

Git仓库的建立便是我们组软件部分工作的起点.

#### 引入Scrum管理模型

对于一个七人的中型团队来说, 如何合理的计划任务与分配工时是开始工作前亟待解决的问题. 我早前在其他公司的IT部门实习, 开发过商业项目. 那短短的十天时间里, 在校内有选修商业课的我, 在完成任务的同时也对于公司内的项目管理方案 - 如何保证一个团队高效能运转 - 十分感兴趣.

Scrum的高效在那段时间里给我留下深刻印象. 大任务一步步拆分成小任务, 小任务按照可用工时每天指派给不同的成员; 每天早上所有人都汇报自己昨天情况和今日计划; 每天的代码持续集成. 当然, Scrum作为一种管理思想, 在执行的时候还是需要制定出明确的方案与流程, 我在结合组内情况之后做出一些细节上的调整. 

首先, 并不是人人都有在一个商业团队里开发的工作经验. 因此对敏捷开发流程比较熟悉的我, 接手了软件团队的管理责任. Scrum开发上手的磨合期内, 如何保证及时的发现并解决问题, 使得这一套流程成为真正提高效率的工具而不是拖累效率的累赘, 这也是一个迫在眉睫的问题. 在选用管理系统的时候, 我在相对易用和专业性之间做出了权衡. ZenHub更加的专业, 但是我担心第一次就引入大量的术语诸如sprint, milestone和epic会导致学习曲线陡峭. 

最后经过权衡, 还是选用上手较为简单但是功能稍弱的Trello作为项目管理平台. 所有的任务化作一张张卡片,在`Todo`, `Doing`或是`Done`三个列表中间流动. 所有的任务卡片放在一张大看板上, 进度一目了然. 事实证明, 这个系统在组内很受欢迎, 后来邻组也开始采用这一套管理平台.

其次, 真正可用的研发时间只有短短的十五天. 任务分配到个人和精确到小时的工时安排, 最大限度降低工时浪费, 从而确保团队内的每个人都可以在最高效率下工作, 虽然前期在磨合的时候工时估计准确度比较有限, 但是等到机械组的零件邮寄到货后, 所有任务的时限都变得容易估计.

事实证明, 引入这样的管理方式使得组内分工明确, 没有像去年天天爆肝的工作安排(我的室友, 老营员王冠说如是), 工作时较其他组更短而进度更快 - 当然, 这也与我们组使用妙算直驱的方案有关 - 那又是另一个故事了.

#### CAN口测试

在最初商讨方案的时候, 我们有过一个大胆的想法: 直接绕过传统上作为主控的开发板, 转而使用妙算直接开发我们的项目. 这样做的好处有二: 其一, 整个机器人系统的通信链路大幅减少, 系统稳定性大幅提升; 其次, 我们可以避免使用诸如Keil这样的上个世纪老古董开发环境, 开发的过程简化且不失优雅. 

随之而来的是一系列的模块设计改动. 

妙算上有两个CAN口, 每条CAN总线上能接8个电机, 这足以驱动我们的机器人. 官方没有提供2Pin到CAN的线材, 于是首先在参考接口定义后改装出了一条线缆用于连接妙算和主控板 - 在我们的方案里, 它被作为CAN的分线板使用. 

然而我们向助教描述方案时, 面对这种打破传统的系统设计, 助教也无法评估该方案的稳定性. 于是在第一天的下午, 王冠和廖洽源编写了CAN驱动电机的程序, 并且对CAN口电机连续做了半个小时的阶跃响应测试. 事实证明, 使用妙算直驱是一个稳健的方案 - 至少在底盘驱动这一块. 同时这个方案也带来了管理上的便捷: 嵌入式和算法的工作紧密耦合, 这也可以部分缓解项目后期王冠离开团队之后的压力.

在最初的方案里, 我们甚至考虑过把所有的设备全部安装在CAN总线上通信, 但是后来考虑到成本和实现复杂度, 以及我们仍然需要开发板手动遥控作为妙算失效时候的备份方案, 最终没有启用这样的设计.

事实证明我们赌对了. 在项目后期, 这个方案节省了大量的嵌入式工作, 我们赢得了很多机械和算法调试时间.


#### 内核实时补丁

其实助教面对妙算直驱方案时的犹豫不是没有道理, 其中一个最大的担忧便是运行Linux的妙算实时性远不如STM32控制器 - 这意味着机器人不一定可以及时的响应环境变化. 因此, 下一个需要解决的技术问题是保证Linux操作系统的实时性.

我是组内对Linux比较熟悉的一个人 - 我平日使用的操作系统正是Linux. 因此我也"理所当然"地成为了组内Linux运维负责人. 我曾经尝试过编译一个Linux内核让它可以运行在一台老旧的386机上. 但是给内核打补丁后再编译的操作则是我未曾尝试过的. 但是转念一想: 来这里, 我为的正是离开自己的舒适区, 踏入自己所不熟悉的领域才能最快速的开拓视野. 基于以上原因, 我接受编译内核的任务.

编译的过程并不顺利. 首先, 妙算全队只有一台, 而彼时测试CAN口的老廖和王冠正在占用机器 - 我需要先在x86的机器上先打好补丁, 再挂到arm64妙算上编译. 但是麻烦远不止这一点. 并不是每一个内核版本都有着对应的实时补丁, 而有实时补丁的内核版本并不与妙算上现有的内核一致, 因此不一定可以在我们的机器上完美运行. 为此我试验了四个版本的内核源代码以及对应的补丁, 来测试妙算的稳定性. 

在这一个过程中, 我重新了解内核的版本号增量规则, 明白incremental版本补丁的含义, 这些都是对我之前认知的颠覆. 但正是这样一次次对自己认识的颠覆, 人们方能在其中学习进步.

回到一个微观的角度来看, 对于这个项目来说内核实时补丁的意义在于: 它直接验证了妙算直驱系统设计的可行性, 为后续开发过程的简洁优雅提供保障. 


#### 遥控移动



#### 绕固定点标签旋转

在底盘运动代码通过测试后, 下一步需要完成的是视觉定位. 依托于妙算全驱的设计, 我们的机器人系统可以使用ROS的通信框架无缝耦合视觉定位和底盘驱动的任务. 

视觉定位的坐标系

后来, 在这个里程碑的基础上, 老廖和王冠继续写出了通过多个AprilTags组成阵列加权平均, 距离近的计算结果赋予更高的权重, 大幅提升视觉定位精度和稳定性.

#### 轨迹规划